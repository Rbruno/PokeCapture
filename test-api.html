<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API TCGdx</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        pre {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .info {
            color: blue;
        }
        .warning {
            color: orange;
        }
    </style>
</head>
<body>
    <h1>üß™ Test API TCGdx</h1>
    <p>Esta p√°gina prueba el SDK de TCGdx desde el CDN</p>
    
    <div class="test-section">
        <h2>1. Verificar SDK</h2>
        <button onclick="testSDK()">Probar SDK B√°sico</button>
        <button onclick="testQuery()">Probar con Query</button>
        <button onclick="testPikachu()">Buscar Pikachu</button>
        <div id="sdk-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Resultados</h2>
        <div id="results"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@tcgdx/sdk@2/dist/tcgdex.browser.js"></script>
    <script>
        function log(elementId, message, type = 'info') {
            const div = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            div.innerHTML += `<p class="${className}">${message}</p>`;
        }
        
        function clear(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }
        
        function showResults(data, title) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        async function testSDK() {
            clear('sdk-result');
            log('sdk-result', 'üîç Verificando SDK...', 'info');
            
            try {
                // Verificar si TCGdex est√° disponible
                if (typeof TCGdex === 'undefined') {
                    log('sdk-result', '‚ùå TCGdex no est√° disponible', 'error');
                    return;
                }
                
                log('sdk-result', '‚úÖ TCGdex est√° disponible', 'success');
                
                // Crear instancia
                const tcgdex = new TCGdex('es');
                log('sdk-result', '‚úÖ SDK inicializado con idioma espa√±ol', 'success');
                
                // Verificar estructura
                log('sdk-result', `üìã Estructura: ${Object.keys(tcgdex).join(', ')}`, 'info');
                
                // Verificar si card existe
                if (!tcgdex.card) {
                    log('sdk-result', '‚ùå tcgdex.card no existe', 'error');
                    return;
                }
                
                log('sdk-result', '‚úÖ tcgdex.card existe', 'success');
                log('sdk-result', `üìã M√©todos de card: ${Object.keys(tcgdex.card).join(', ')}`, 'info');
                
                // Intentar obtener algunas cartas
                log('sdk-result', 'üîç Obteniendo primeras 5 cartas...', 'info');
                const cards = await tcgdex.card.list();
                
                if (Array.isArray(cards) && cards.length > 0) {
                    log('sdk-result', `‚úÖ Obtenidas ${cards.length} cartas`, 'success');
                    log('sdk-result', `üìã Primera carta: ${cards[0].name || cards[0].id || 'Sin nombre'}`, 'info');
                    showResults(cards.slice(0, 5), 'Primeras 5 cartas');
                } else {
                    log('sdk-result', '‚ö†Ô∏è No se obtuvieron cartas o el formato es inesperado', 'warning');
                    showResults(cards, 'Resultado completo');
                }
                
            } catch (error) {
                log('sdk-result', `‚ùå Error: ${error.message}`, 'error');
                log('sdk-result', `üìã Stack: ${error.stack}`, 'error');
            }
        }
        
        async function testQuery() {
            clear('sdk-result');
            log('sdk-result', 'üîç Probando Query...', 'info');
            
            try {
                if (typeof TCGdex === 'undefined') {
                    log('sdk-result', '‚ùå TCGdex no est√° disponible', 'error');
                    return;
                }
                
                // Verificar si Query est√° disponible
                let Query = null;
                if (TCGdex.Query) {
                    Query = TCGdex.Query;
                    log('sdk-result', '‚úÖ Query encontrado en TCGdex.Query', 'success');
                } else if (window.Query) {
                    Query = window.Query;
                    log('sdk-result', '‚úÖ Query encontrado en window.Query', 'success');
                } else {
                    log('sdk-result', '‚ùå Query no est√° disponible', 'error');
                    log('sdk-result', 'üí° Query puede requerir importaci√≥n separada', 'info');
                    return;
                }
                
                const tcgdex = new TCGdex('es');
                
                // Probar paginaci√≥n
                log('sdk-result', 'üîç Probando paginaci√≥n (p√°gina 1, 3 cartas)...', 'info');
                const paginatedCards = await tcgdex.card.list(
                    Query.create().paginate(1, 3)
                );
                
                if (Array.isArray(paginatedCards) && paginatedCards.length > 0) {
                    log('sdk-result', `‚úÖ Paginaci√≥n funciona: ${paginatedCards.length} cartas`, 'success');
                    showResults(paginatedCards, 'Cartas paginadas');
                } else {
                    log('sdk-result', '‚ö†Ô∏è Paginaci√≥n no devolvi√≥ resultados esperados', 'warning');
                    showResults(paginatedCards, 'Resultado de paginaci√≥n');
                }
                
            } catch (error) {
                log('sdk-result', `‚ùå Error: ${error.message}`, 'error');
                log('sdk-result', `üìã Stack: ${error.stack}`, 'error');
            }
        }
        
        async function testPikachu() {
            clear('sdk-result');
            log('sdk-result', 'üîç Buscando cartas de Pikachu...', 'info');
            
            try {
                if (typeof TCGdex === 'undefined') {
                    log('sdk-result', '‚ùå TCGdex no est√° disponible', 'error');
                    return;
                }
                
                const tcgdex = new TCGdex('es');
                
                // Intentar con Query si est√° disponible
                let Query = TCGdex.Query || window.Query;
                
                if (Query) {
                    log('sdk-result', '‚úÖ Usando Query para buscar Pikachu', 'success');
                    const pikachuCards = await tcgdex.card.list(
                        Query.create()
                            .equal('name', 'Pikachu')
                    );
                    
                    if (Array.isArray(pikachuCards) && pikachuCards.length > 0) {
                        log('sdk-result', `‚úÖ Encontradas ${pikachuCards.length} cartas de Pikachu`, 'success');
                        showResults(pikachuCards.slice(0, 10), `Cartas de Pikachu (mostrando 10 de ${pikachuCards.length})`);
                    } else {
                        log('sdk-result', '‚ö†Ô∏è No se encontraron cartas de Pikachu con Query', 'warning');
                    }
                } else {
                    log('sdk-result', '‚ö†Ô∏è Query no disponible, obteniendo todas las cartas y filtrando...', 'warning');
                    const allCards = await tcgdex.card.list();
                    const pikachuCards = allCards.filter(card => 
                        card.name && card.name.toLowerCase().includes('pikachu')
                    );
                    
                    if (pikachuCards.length > 0) {
                        log('sdk-result', `‚úÖ Encontradas ${pikachuCards.length} cartas de Pikachu (filtrado manual)`, 'success');
                        showResults(pikachuCards.slice(0, 10), `Cartas de Pikachu (mostrando 10 de ${pikachuCards.length})`);
                    } else {
                        log('sdk-result', '‚ùå No se encontraron cartas de Pikachu', 'error');
                    }
                }
                
            } catch (error) {
                log('sdk-result', `‚ùå Error: ${error.message}`, 'error');
                log('sdk-result', `üìã Stack: ${error.stack}`, 'error');
            }
        }
        
        // Verificar cuando se carga la p√°gina
        window.addEventListener('load', () => {
            setTimeout(() => {
                clear('sdk-result');
                log('sdk-result', 'üìã Verificando disponibilidad del SDK...', 'info');
                
                if (typeof TCGdex !== 'undefined') {
                    log('sdk-result', '‚úÖ TCGdex est√° disponible', 'success');
                    log('sdk-result', `üìã Query disponible: ${!!(TCGdex.Query || window.Query)}`, 'info');
                } else {
                    log('sdk-result', '‚ùå TCGdex no est√° disponible', 'error');
                    log('sdk-result', 'üí° Aseg√∫rate de que el script del CDN se haya cargado', 'info');
                }
            }, 500);
        });
    </script>
    
</body>
</html>
